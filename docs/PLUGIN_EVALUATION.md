# ChatStack 插件评价体系

本文档定义从多维度评价本插件「好坏」的标准，用于自评、迭代与复评。评价结果不修改代码，仅作为状态快照与改进依据。

---

## 一、功能完整性与正确性

### 评价标准

README 与产品承诺的功能是否全部实现，且行为符合预期、无明显错误或遗漏。

### 可检项

| 类别 | 检查项 | 说明 |
|------|--------|------|
| 侧边栏 | 注入与显示 | 在 ChatGPT/Gemini 会话页右侧正确注入侧边栏，宽度可调 |
| | Tab 切换 | 当前对话 / 历史 / 项目 三个 Tab 可正常切换 |
| TOC | 目录生成 | 以用户提问为条目，前 36 字为标题，实时更新 |
| | 跳转与高亮 | 点击条目滚动到对应消息并高亮约 2 秒 |
| | 流式支持 | 流式输出时目录不频繁闪烁，有 debounce |
| 搜索 | 全文搜索 | 大小写不敏感，显示匹配片段，点击跳转 |
| | 用户/助手消息 | 两种消息的搜索结果均可正确跳转并高亮 |
| 历史 | 列表与筛选 | 按平台分组，支持日期范围、平台筛选、关键词搜索 |
| | 详情与操作 | 进入对话详情可查看消息、收藏、添加到项目、打开新标签、删除 |
| 项目 | Auto 项目 | 镜像 ChatGPT 原生项目结构，只读 |
| | My 项目 | 新建/重命名/删除项目，会话可加入多项目，拖拽移动 |
| | 添加到项目 | 从当前对话/历史/项目详情均可「添加到项目」 |
| 导出 | 多范围 | 当前对话、历史、项目 均可进入导出模式 |
| | 多格式 | JSON / MD / TXT 可选，可打包 ZIP |
| 其他 | 收藏 | 消息可收藏，可按收藏筛选 |
| | 多平台 | ChatGPT、Gemini 均支持（Claude 可选） |
| | 设置 | 自动保存、语言、主题、清空数据 |

### 产出形式

- 功能列表 + 每项标注：**已实现 / 部分实现 / 未实现**
- 已知 bug 或局限（可引用 BUGFIX、TEST_REPORT）

---

## 二、代码质量与可维护性

### 评价标准

结构清晰、重复少、关键逻辑可读、便于扩展与修 bug；无明显死代码与过度耦合。

### 可检项

| 类别 | 检查项 | 说明 |
|------|--------|------|
| 架构 | 模块划分 | content / core / 各 adapter、sidebar 子模块职责清晰 |
| | 依赖方向 | 核心逻辑不依赖 UI 细节，adapter 与平台解耦 |
| | 单文件体量 | 单文件不宜过大（如 >2000 行需考虑拆分） |
| 实现 | 死代码 | 无未调用的函数、未使用的导出或常量 |
| | 重复 | 相同逻辑尽量集中（如 escapeHtml、日期格式化） |
| | 错误处理 | config 为空、DOM 缺失、storage 失败有统一防御 |
| | 日志 | 调试日志可控（如 DEBUG 开关），不泄露敏感信息 |
| 可维护性 | 注释与命名 | 关键模块有注释，复杂逻辑有说明 |
| | 配置集中 | 选择器、常量、默认值便于一处修改 |

### 产出形式

- 简要模块/依赖说明
- 风险点列表（含文件与行号建议）
- 改进优先级建议

---

## 三、用户体验与无障碍

### 评价标准

界面清晰、操作符合直觉；多语言与主题一致；关键操作可被辅助技术识别并有反馈。

### 可检项

| 类别 | 检查项 | 说明 |
|------|--------|------|
| i18n | 覆盖范围 | 界面文案、占位符、提示、按钮均有中英文 |
| | 无硬编码 | 无未走 i18n 的中文/英文裸串 |
| | 语言切换 | 设置中切换语言后界面即时更新 |
| 主题 | 明/暗/自动 | 浅色、深色、跟随系统均生效且无错位 |
| | 与页面协调 | 侧边栏与主站风格不冲突 |
| 无障碍 | 焦点与键盘 | 关键控件可聚焦，必要时支持键盘操作 |
| | 语义与标签 | 按钮/输入框有 aria-label 或 title，图标有说明 |
| 反馈 | 操作结果 | 成功/失败有 toast 或明确状态（如复制成功、清空完成） |
| | 加载与空状态 | 加载中、无数据时有明确提示 |

### 产出形式

- i18n / 主题覆盖情况简述
- 无障碍与反馈缺口列表（含控件或页面位置）

---

## 四、性能与资源

### 评价标准

不拖慢主页面；不无限增长内存；存储使用在合理范围内。

### 可检项

| 类别 | 检查项 | 说明 |
|------|--------|------|
| 加载 | 脚本体积与顺序 | manifest 中脚本按依赖顺序加载，无冗余 |
| | 首屏 | 侧边栏出现时间可接受 |
| 运行时 | 高频操作 | TOC 更新、搜索、筛选有 debounce/throttle |
| | DOM 操作 | 避免整页重绘，优先局部更新或事件委托 |
| | 监听器 | 避免重复绑定、及时解绑 |
| 存储 | chrome.storage | 使用方式合理，大量历史/项目时考虑分页或懒加载 |
| | 单条数据大小 | 单会话/单条消息存储不过大 |

### 产出形式

- 当前策略简述（如 debounce 延迟、更新粒度）
- 潜在瓶颈或优化建议（不跑浏览器时可标为「待实测」）

---

## 五、安全与权限

### 评价标准

最小权限；无 XSS；用户数据不泄露、不随意发往外部。

### 可检项

| 类别 | 检查项 | 说明 |
|------|--------|------|
| 权限 | manifest | permissions / host_permissions 仅包含必要项 |
| | 说明 | 权限用途在描述或文档中可理解 |
| XSS | 用户内容注入 | 用户生成内容或对话内容注入 DOM 前经转义（如 escapeHtml） |
| | 无危险拼接 | 避免未转义内容直接 innerHTML 或 eval |
| 数据 | 存储位置 | 配置与对话数据仅存本地（chrome.storage.local） |
| | 外发 | 不向第三方发送对话内容或标识符（除打开官方页面） |

### 产出形式

- 权限清单与用途简述
- 数据流简述（输入 → 存储 → 展示）
- 已做/未做的安全点列表

---

## 六、兼容性与健壮性

### 评价标准

在声明的环境（如 Chrome MV3、指定 host）下稳定运行；目标页 DOM/产品变更时易定位与修复。

### 可检项

| 类别 | 检查项 | 说明 |
|------|--------|------|
| 平台 | Manifest V3 | 使用 MV3 规范，Service Worker 无长期占用 |
| | 浏览器 | 声明的浏览器（Chrome/Edge 等）下无兼容性问题 |
| 目标页 | DOM 依赖 | 选择器集中（如 adapter 内），有注释说明「若改版需改哪里」 |
| | 页面类型 | 仅在会话页激活；非会话页有提示或静默 |
| 异常 | 扩展重载 | context 失效时有检测与降级（如 isExtensionContextValid） |
| | 存储失败 | get/set 失败不导致白屏，有降级或提示 |

### 产出形式

- 兼容性矩阵（浏览器 × 页面类型）
- 已知脆弱点（如依赖 ChatGPT 的 DOM 结构）
- 建议的回归测试场景

---

## 七、文档与可测试性

### 评价标准

新人能按文档安装并完成基本验证；关键流程有测试指引；便于回归与发布前检查。

### 可检项

| 类别 | 检查项 | 说明 |
|------|--------|------|
| 文档 | README | 功能说明、安装步骤、基本使用、测试清单 |
| | 快速开始 | QUICKSTART 等可在 5–10 分钟内跑通 |
| | 结构与架构 | PROJECT_STRUCTURE 或等价说明，便于接手 |
| 测试 | 手动清单 | TEST_REPORT 或等价清单与当前功能一致 |
| | 自动化 | 是否有单元测试 / E2E（无则标注「无」） |
| | 回归 | 关键路径有明确步骤，便于发版前勾选 |
| 代码 | 注释 | 关键模块、复杂函数有入参/返回值或行为说明 |

### 产出形式

- 文档覆盖表（文档名 → 覆盖内容）
- 测试缺口（如无单元测试、无 E2E）
- 建议的下一步（如补充某类测试或某节文档）

---

## 使用方式

1. **自评**：按上述七维度逐项检查，在「当前状态报告」中填写结论与依据。
2. **复评**：发版前或大改动后重新走一遍清单，更新报告。
3. **改进**：根据「未达标」与「风险点」制定优先级，在迭代中逐步补齐。

评价结果以「达标 / 部分达标 / 未达标」为主，必要时附简短理由与文件/行号，便于追踪。
